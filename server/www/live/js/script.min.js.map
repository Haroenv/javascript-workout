{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","server/www/src/js/script.js","server/www/src/js/classes/MobilePresentation.js","shared/js/Constants.js","shared/js/classes/slides/ContentBase.js","shared/js/classes/IFrameBridge.js","shared/js/classes/MobileServerBridge.js","shared/js/classes/Presentation.js","server/www/src/js/classes/slides/react-phones/index.js","server/www/src/js/classes/slides/shake-your-phones/index.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.min.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(){\n\n\tvar MobilePresentation = require('./classes/MobilePresentation');\n\n\tfunction init(){\n\t\tif($('#presentation').length > 0) {\n\t\t\t//load the data.json\n\t\t\t$.get('/data.json').done(function(result){\n\t\t\t\tnew MobilePresentation(result, 'mobile');\n\t\t\t});\n\t\t}\n\t}\n\n\tinit();\n})();","module.exports = (function(){\n\n\tvar Constants = require('Constants');\n\n\tvar PresentationBase = require('shared/Presentation');\n\tvar MobileServerBridge = require('shared/MobileServerBridge');\n\t\n\tfunction MobilePresentation(data, role) {\n\t\tthis.$overlay = $('#overlay');\n\t\tPresentationBase.call(this, data, role);\n\t}\n\n\tMobilePresentation.prototype = Object.create(PresentationBase.prototype);\n\n\tMobilePresentation.prototype.createMobileServerBridge = function() {\n\t\treturn new MobileServerBridge(this, '');\n\t};\n\n\tMobilePresentation.prototype.handleMobileServerMessage = function(message) {\n\t\tif(!message.content) {\n\t\t\treturn;\n\t\t}\n\t\tif(message.content.action == 'setCurrentSlideIndex') {\n\t\t\tthis.setCurrentSlideIndex(message.content.currentSlideIndex);\n\t\t} else if(message.content.action == Constants.BLINK) {\n\t\t\tthis.blink(message.content.text, message.content.backgroundColor);\n\t\t}\n\t};\n\n\tMobilePresentation.prototype.setCurrentSlideIndex = function(index) {\n\t\tPresentationBase.prototype.setCurrentSlideIndex.call(this, index);\n\t\tthis.$overlay.removeClass('active');\n\t\tif(this.blinkInterval) {\n\t\t\tclearInterval(this.blinkInterval);\n\t\t}\n\t};\n\n\tMobilePresentation.prototype.blink = function(text, backgroundColor) {\n\t\t//overlay important, blinking text\n\t\tthis.$overlay.find('.content').html(text);\n\t\tthis.$overlay.addClass('active');\n\t\tif(this.blinkInterval) {\n\t\t\tclearInterval(this.blinkInterval);\n\t\t}\n\t\tthis.blinkInterval = setInterval(this.blinkToggle.bind(this, backgroundColor), 500);\n\t};\n\n\tMobilePresentation.prototype.blinkToggle = function(backgroundColor) {\n\t\tthis.$overlay.toggleClass('blink-on');\n\t\tif(this.$overlay.hasClass('blink-on')) {\n\t\t\tthis.$overlay.css('background-color', backgroundColor);\n\t\t} else {\n\t\t\tthis.$overlay.css('background-color', false);\n\t\t}\n\t};\n\n\treturn MobilePresentation;\n\n})();","module.exports = (function(){\n\t\n\tvar Constants = {\n\t\tGO_TO_PREVIOUS_SLIDE : 'goToPreviousSlide',\n\t\tGO_TO_NEXT_SLIDE : 'goToNextSlide',\n\t\tSET_SLIDES : 'setSlides',\n\t\tSET_CURRENT_SLIDE_INDEX : 'setCurrentSlideIndex',\n\n\t\tMESSAGE : 'message',\n\t\tSOCKET_SEND : 'socketSend',\n\t\tSOCKET_RECEIVE : 'socketReceive',\n\t\tJOIN_SLIDE_ROOM : 'joinSlideRoom',\n\t\tLEAVE_SLIDE_ROOM : 'leaveSlideRoom',\n\n\t\tROLE_PRESENTATION : 'presentation',\n\t\tROLE_MOBILE : 'mobile',\n\n\t\tSTATE_ACTIVE : 'active',\n\t\tSTATE_INACTIVE : 'inactive',\n\n\t\tSET_SUBSTATE : 'setSubstate',\n\n\t\tSHAKE_YOUR_PHONES_INTRO : 'shakeYourPhonesIntro',\n\t\tSHAKE_YOUR_PHONES_GAME : 'shakeYourPhonesGame',\n\t\tSHAKE_YOUR_PHONES_FINISHED : 'shakeYourPhonesFinished',\n\n\t\tSHAKE_YOUR_PHONES_CLIENT_ADDED : 'shakeYourPhonesClientAdded',\n\t\tSHAKE_YOUR_PHONES_CLIENT_REMOVED : 'shakeYourPhonesClientRemoved',\n\t\tSHAKE_YOUR_PHONES_CLIENT_LIST : 'shakeYourPhonesClientList',\n\t\tSHAKE_YOUR_PHONES_CLIENT_UPDATE : 'shakeYourPhonesClientUpdate',\n\n\t\tHIGHEST_HEARTRATE_GAME_INTRO : 'highestHeartrateGameIntro',\n\t\tHIGHEST_HEARTRATE_GAME_GAME : 'highestHeartrateGameGame',\n\t\tHIGHEST_HEARTRATE_GAME_FINISHED : 'highestHeartrateGameFinished',\n\n\t\tLOWEST_HEARTRATE_GAME_INTRO : 'lowestHeartrateGameIntro',\n\t\tLOWEST_HEARTRATE_GAME_GAME : 'lowestHeartrateGameGame',\n\t\tLOWEST_HEARTRATE_GAME_FINISHED : 'lowestHeartrateGameFinished',\n\n\t\tREACT_PHONES_INTRO : 'reactPhonesIntro',\n\t\tREACT_PHONES_GAME : 'reactPhonesGame',\n\t\tREACT_PHONES_FINISHED : 'reactPhonesFinished',\n\n\t\tREACT_PHONES_CLIENT_ADDED : 'reactPhonesClientAdded',\n\t\tREACT_PHONES_CLIENT_REMOVED : 'reactPhonesClientRemoved',\n\t\tREACT_PHONES_CLIENT_LIST : 'reactPhonesClientList',\n\t\tREACT_PHONES_CLIENT_UPDATE : 'reactPhonesClientUpdate',\n\n\t\tDANCE_PAD_GAME_INTRO : 'dancePadGameIntro',\n\t\tDANCE_PAD_GAME_GAME : 'dancePadGameGame',\n\t\tDANCE_PAD_GAME_FINISHED : 'dancePadGameFinished',\n\n\t\tUPDATE_MAXIMUM_MOTION : 'updateMaximumMotion',\n\t\tUPDATE_REACTION_SPEED : 'updateReactionSpeed',\n\t\tHEART_RATE_POLAR : 'heartRatePolar',\n\t\tHEART_RATE_SPARK : 'heartRateSpark',\n\t\tSELECT_WINNER : 'selectWinner',\n\t\tBLINK : 'blink',\n\n\t\tTWEET : 'tweet',\n\t\tGET_ALL_TWEETS : 'getAllTweets',\n\t\tGET_ALL_TWEETS_RESULT : 'getAllTweetsResult',\n\n\t\tCHILD_APP_SAVE_CODE : 'childAppSaveCode',\n\t\tCHILD_APP_RUN_CODE : 'childAppRunCode',\n\t\tOPEN_COMMAND_LINE: 'openCommandLine',\n\t\tOPEN_CAMERA: 'openCamera'\n\t};\n\n\treturn Constants;\n\n})();","module.exports = (function(){\n\t\n\tvar Constants = require('Constants');\n\n\tfunction ContentBase(name) {\n\t\tthis.name = name;\n\t\tthis.fps = 60;\n\t\tthis._animationFrameId = false;\n\t\tthis._currentTime = 0;\n\t\tthis._delta = 0;\n\t\tthis._interval = false;\n\t\tthis._lastTime = new Date().getTime();\n\t\tthis.currentFrame = 0;\n\n\t\twindow.addEventListener(\"message\", this.receiveMessage.bind(this), false);\n\n\t\tthis.__drawLoop = this._drawLoop.bind(this);\n\t\tthis._interval = 1000 / this.fps;\n\t}\n\n\tContentBase.prototype.receiveMessage = function(event) {\n\t\tif(!event.data) {\n\t\t\treturn;\n\t\t}\n\t\tswitch(event.data.action) {\n\t\t\tcase 'setState':\n\t\t\t\tthis.setState(event.data.state);\n\t\t\t\tbreak;\n\t\t\tcase Constants.SOCKET_RECEIVE:\n\t\t\t\tthis.receiveSocketMessage(event.data.message);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.handleMessage(event.data);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tContentBase.prototype.postMessage = function(data) {\n\t\tparent.postMessage(data, \"*\");\n\t};\n\n\tContentBase.prototype.handleMessage = function(data) {\n\t};\n\n\tContentBase.prototype.postSocketMessage = function(message) {\n\t\tthis.postMessage({\n\t\t\taction: Constants.SOCKET_SEND,\n\t\t\tmessage: message\n\t\t});\n\t};\n\n\tContentBase.prototype.receiveSocketMessage = function(message) {\n\t\t//console.log('ContentBase.prototype.receiveSocketMessage ' + this.name, message);\n\t};\n\n\tContentBase.prototype.setState = function(state) {\n\t\tif(state !== this.state) {\n\t\t\tthis.state = state;\n\t\t\tthis.onStateChanged();\n\t\t\tif(this.state === Constants.STATE_ACTIVE) {\n\t\t\t\tthis.currentFrame = 0;\n\t\t\t\tthis._drawLoop();\n\t\t\t} else {\n\t\t\t\twindow.cancelAnimationFrame(this._animationFrameId);\n\t\t\t}\n\t\t}\n\t};\n\n\tContentBase.prototype.onStateChanged = function() {\n\t};\n\n\tContentBase.prototype._drawLoop = function() {\n\t\tthis._animationFrameId = window.requestAnimationFrame(this.__drawLoop);\n\t\tthis._currentTime = (new Date()).getTime();\n\t    this._delta = (this._currentTime - this._lastTime);\n\t    if(this._delta > this._interval) {\n\t    \tthis.currentFrame++;\n\t    \tthis.drawLoop(this._delta);\n\t    \tthis._lastTime = this._currentTime - (this._delta % this._interval);\n\t    }\n\t};\n\n\tContentBase.prototype.drawLoop = function(delta) {\n\t};\n\n\treturn ContentBase;\n\n})();","module.exports = (function(){\n\tfunction getIframeWindow(iframe_object) {\n\t\tvar doc;\n\n\t\tif (iframe_object.contentWindow) {\n\t\t\treturn iframe_object.contentWindow;\n\t\t}\n\n\t\tif (iframe_object.window) {\n\t\t\treturn iframe_object.window;\n\t\t} \n\n\t\tif (!doc && iframe_object.contentDocument) {\n\t\t\tdoc = iframe_object.contentDocument;\n\t\t} \n\n\t\tif (!doc && iframe_object.document) {\n\t\t\tdoc = iframe_object.document;\n\t\t}\n\n\t\tif (doc && doc.defaultView) {\n\t\t return doc.defaultView;\n\t\t}\n\n\t\tif (doc && doc.parentWindow) {\n\t\t\treturn doc.parentWindow;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfunction IFrameBridge(data) {\n\t\tthis.data = data;\n\t\tthis.name = this.data.name;\n\t}\n\n\tIFrameBridge.prototype.isAlreadyCorrectlyAttached = function(iframe, src) {\n\t\treturn (this.iframe === iframe && $(iframe).attr('name') === this.name && $(iframe).attr('src') === src);\n\t};\n\n\tIFrameBridge.prototype.attachToIframe = function(iframe, src, cb) {\n\t\tthis.iframe = iframe;\n\t\t$(iframe).off('load');\n\t\t$(iframe).attr('name', this.name);\n\t\tif(src !== $(iframe).attr('src')) {\n\t\t\t$(iframe).on('load', (function(event){\n\t\t\t\tthis.tryToPostMessage({\n\t\t\t\t\taction: 'setState',\n\t\t\t\t\tstate: this.state\n\t\t\t\t});\n\t\t\t\tcb();\n\t\t\t}).bind(this));\n\t\t\t$(iframe).attr('src', src);\n\t\t}\n\t};\n\n\tIFrameBridge.prototype.setState = function(state) {\n\t\tthis.state = state;\n\t\tthis.tryToPostMessage({\n\t\t\taction: 'setState',\n\t\t\tstate: this.state\n\t\t});\n\t};\n\n\tIFrameBridge.prototype.tryToPostMessage = function(message) {\n\t\tif(!this.iframe) {\n\t\t\treturn;\n\t\t}\n\t\tvar w = getIframeWindow(this.iframe);\n\t\tif(w) {\n\t\t\tw.postMessage(message, \"*\");\n\t\t}\n\t};\n\n\treturn IFrameBridge;\n})();","module.exports = (function(){\n\n\tvar Constants = require('Constants');\n\n\tfunction MobileServerBridge(presentation, url) {\n\t\tthis.presentation = presentation;\n\t\tthis.url = url;\n\t\tthis.connect();\n\t}\n\n\tMobileServerBridge.prototype.connect = function() {\n\t\tconsole.log('MobileServerBridge.connect');\n\t\t$.post(this.url + '/login', this.getLoginCredentials()).done(this.loginHandler.bind(this))\n\t\t.fail((function() {\n\t\t\t//retry after one second\n\t\t\tsetTimeout((function(){\n\t\t\t\tthis.connect();\n\t\t\t}).bind(this), 1000);\n\t  }).bind(this));\n\t};\n\n\tMobileServerBridge.prototype.getLoginCredentials = function() {\n\t\treturn {};\n\t};\n\n\tMobileServerBridge.prototype.loginHandler = function(result) {\n\t\tthis.token = result.token;\n\t\tthis.socket = io(this.url, {\n\t\t\tquery: 'token=' + this.token,\n\t\t\treconnection: false,\n\t\t\tforceNew: true\n\t\t});\n\t\tthis.socket.on('connect', this.socketConnectHandler.bind(this));\n\t\tthis.socket.on('disconnect', this.socketDisconnectHandler.bind(this));\n\t\tthis.socket.on('message', this.socketMessageHandler.bind(this));\n\t};\n\n\tMobileServerBridge.prototype.socketConnectHandler = function() {\n\t\tconsole.log('MobileServerBridge.socketConnectHandler');\n\t\tthis.presentation.mobileServerBridgeConnected();\n\t};\n\n\tMobileServerBridge.prototype.socketDisconnectHandler = function() {\n\t\tthis.connect();\n\t};\n\n\tMobileServerBridge.prototype.tryToSend = function() {\n\t\tif(this.socket) {\n\t\t\tthis.socket.emit.apply(this.socket, arguments);\n\t\t}\n\t};\n\n\tMobileServerBridge.prototype.socketMessageHandler = function(message) {\n\t\tthis.presentation.mobileServerMessageHandler(message);\n\t};\n\n\treturn MobileServerBridge;\n})();","module.exports = (function(){\n\n\tvar Constants = require('Constants');\n\tvar IFrameBridge = require('./IFrameBridge');\n\n\t/*\n\t * data: json object with slides array property\n\t * role: mobile or presentation\n\t */\n\tfunction Presentation(data, role) {\n\t\tthis.data = data;\n\t\tthis.role = role;\n\t\tthis.currentSlideIndex = -1;\n\t\tthis.iframes = [];\n\t\tthis.numIframes = 3;\n\t\tthis.iFrameBridges = [];\n\t\tthis.iFrameBridgesBySlideName = {};\n\n\t\tthis.createIFrames();\n\t\tthis.createIFrameBridges(this.data);\n\n\t\tthis.mobileServerBridge = this.createMobileServerBridge();\n\t\twindow.addEventListener(\"message\", this.iFrameMessageHandler.bind(this), false);\n\n\t\tthis.setCurrentSlideIndex(0);\n\t}\n\n\tPresentation.prototype.createIFrames = function() {\n\t\tfor(var i = 0; i < this.numIframes; i++) {\n\t\t\tvar $iframe = $('<iframe class=\"slide-frame\" />');\n\t\t\tthis.iframes.push($iframe);\n\t\t\t$('#presentation').append($iframe);\n\t\t}\n\t};\n\n\tPresentation.prototype.createIFrameBridges = function(data) {\n\t\tvar that = this;\n\t\tvar numSlides = data.slides.length;\n\t\tfor(var i = 0; i < numSlides; i++) {\n\t\t\tvar iFrameBridge = this.createIframeBridge(data.slides[i]);\n\t\t\tthis.iFrameBridges.push(iFrameBridge);\n\t\t\tthis.iFrameBridgesBySlideName[iFrameBridge.name] = iFrameBridge;\n\t\t}\n\t};\n\n\tPresentation.prototype.createIframeBridge = function(slide) {\n\t\treturn new IFrameBridge(slide);\n\t};\n\n\tPresentation.prototype.iFrameMessageHandler = function(event) {\n\t\tif(!event.data) {\n\t\t\treturn;\n\t\t}\n\t\tswitch(event.data.action) {\n\t\t\tcase Constants.SOCKET_SEND:\n\t\t\t\tif(this.mobileServerBridge) {\n\t\t\t\t\tthis.mobileServerBridge.tryToSend(Constants.MESSAGE, event.data.message);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tPresentation.prototype.mobileServerBridgeConnected = function() {\n\t\t//join the rooms of the iframes\n\t\tfor(var i = 0; i < this.numIframes; i++) {\n\t\t\tthis.mobileServerBridge.tryToSend(Constants.JOIN_SLIDE_ROOM, $(this.iframes[i]).attr('name'));\n\t\t}\n\t};\n\n\tPresentation.prototype.mobileServerMessageHandler = function(message) {\n\t\tif(message.target.slide) {\n\t\t\t//slide has to handle the message\n\t\t\tvar iFrameBridge = this.getIFrameBridgeBySlideName(message.target.slide);\n\t\t\tif(iFrameBridge) {\n\t\t\t\tiFrameBridge.tryToPostMessage({\n\t\t\t\t\taction: Constants.SOCKET_RECEIVE,\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t//presentation has to handle the message\n\t\t\tthis.handleMobileServerMessage(message);\n\t\t}\n\t};\n\n\tPresentation.prototype.handleMobileServerMessage = function(message) {\n\t\tconsole.log('[shared/Presentation] handleMobileServerMessage', message);\n\t};\n\n\tPresentation.prototype.getIFrameBridgeByIndex = function(index) {\n\t\tif(index >= 0 && index < this.iFrameBridges.length) {\n\t\t\treturn this.iFrameBridges[index];\n\t\t}\n\t\treturn false;\n\t};\n\n\tPresentation.prototype.getIFrameBridgeBySlideName = function(slideName) {\n\t\treturn this.iFrameBridgesBySlideName[slideName];\n\t};\n\n\tPresentation.prototype.getIFrameForSlide = function(slide, slidesNotToClear) {\n\t\tif(slide) {\n\t\t\tvar $iframe = $('iframe[name=' + slide.name + ']');\n\t\t\tif($iframe.length > 0) {\n\t\t\t\treturn $iframe[0];\n\t\t\t}\n\t\t\t//get a free iframe\n\t\t\tvar slideNamesNotToClear = [];\n\t\t\t$(slidesNotToClear).each(function(index, obj){\n\t\t\t\tslideNamesNotToClear.push(obj.name);\n\t\t\t});\n\t\t\tvar $iframes = $('iframe.slide-frame');\n\t\t\tfor (var i = $iframes.length - 1; i >= 0; i--) {\n\t\t\t\t$iframe = $($iframes[i]);\n\t\t\t\tvar name = $iframe.attr('name');\n\t\t\t\tif(!name || slideNamesNotToClear.indexOf(name) === -1) {\n\t\t\t\t\treturn $iframe[0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t};\n\n\tPresentation.prototype.goToPreviousSlide = function() {\n\t\tthis.setCurrentSlideIndex(this.currentSlideIndex - 1);\n\t};\n\n\tPresentation.prototype.goToNextSlide = function() {\n\t\tthis.setCurrentSlideIndex(this.currentSlideIndex + 1);\n\t};\n\n\tPresentation.prototype.setCurrentSlideIndex = function(value) {\n\t\tvalue = Math.max(0, Math.min(value, this.iFrameBridges.length - 1));\n\t\tif(value !== this.currentSlideIndex) {\n\t\t\tthis.currentSlideIndex = value;\n\n\t\t\tvar currentIFrameBridge = this.getIFrameBridgeByIndex(this.currentSlideIndex);\n\t\t\tvar previousIFrameBridge = this.getIFrameBridgeByIndex(this.currentSlideIndex - 1);\n\t\t\tvar nextIFrameBridge = this.getIFrameBridgeByIndex(this.currentSlideIndex + 1);\n\n\t\t\tvar currentIframe = this.getIFrameForSlide(currentIFrameBridge, [previousIFrameBridge, nextIFrameBridge]);\n\t\t\tthis.setupIFrame(currentIframe, currentIFrameBridge, Constants.STATE_ACTIVE, 0);\n\n\t\t\tvar previousIframe = this.getIFrameForSlide(previousIFrameBridge, [currentIFrameBridge, nextIFrameBridge]);\n\t\t\tthis.setupIFrame(previousIframe, previousIFrameBridge, Constants.STATE_INACTIVE, '-100%');\n\n\t\t\tvar nextIframe = this.getIFrameForSlide(nextIFrameBridge, [previousIFrameBridge, currentIFrameBridge]);\n\t\t\tthis.setupIFrame(nextIframe, nextIFrameBridge, Constants.STATE_INACTIVE, '100%');\n\n\t\t\t//all other iframe bridges should be unlinked from their iframe\n\t\t\tthis.iFrameBridges.forEach(function(iFrameBridge){\n\t\t\t\tif(iFrameBridge === currentIFrameBridge) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(iFrameBridge === previousIFrameBridge) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(iFrameBridge === nextIFrameBridge) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tiFrameBridge.iframe = null;\n\t\t\t});\n\n\t\t\tbean.fire(this, Constants.SET_CURRENT_SLIDE_INDEX, [this.currentSlideIndex]);\n\t\t}\n\t};\n\n\tPresentation.prototype.setupIFrame = function(iFrame, iFrameBridge, state, left) {\n\t\tif(iFrame) {\n\t\t\tvar src = \"slides/\" + iFrameBridge.name + '.html';\n\t\t\tif(iFrameBridge.data[this.role] && iFrameBridge.data[this.role].url) {\n\t\t\t\tsrc = iFrameBridge.data[this.role].url;\n\t\t\t}\n\t\t\tif(iFrameBridge.isAlreadyCorrectlyAttached(iFrame, src)) {\n\t\t\t\t//console.log(iFrameBridge.name + ' already attached');\n\t\t\t} else {\n\t\t\t\t//leave previous channel of this iframe\n\t\t\t\tif(this.mobileServerBridge) {\n\t\t\t\t\tthis.mobileServerBridge.tryToSend(Constants.LEAVE_SLIDE_ROOM, $(iFrame).attr('name'));\n\t\t\t\t}\n\t\t\t\t//add the join as a callback for the onload event\n\t\t\t\tiFrameBridge.attachToIframe(iFrame, src, (function(){\n\t\t\t\t\t//join new channel\n\t\t\t\t\tif(this.mobileServerBridge) {\n\t\t\t\t\t\tthis.mobileServerBridge.tryToSend(Constants.JOIN_SLIDE_ROOM, $(iFrame).attr('name'));\n\t\t\t\t\t}\n\t\t\t\t}).bind(this));\n\t\t\t}\n\t\t\tiFrameBridge.setState(state);\n\t\t\t$(iFrame).css('left', left);\n\t\t}\n\t};\n\n\tPresentation.prototype.createMobileServerBridge = function() {\n\t\t//to implement in extending classes\n\t};\n\n\treturn Presentation;\n\n})();","module.exports = (function(){\n\n\tvar Constants = require('Constants');\n\tvar ContentBase = require('shared/ContentBase');\n\t\n\tfunction ReactPhones() {\n\t\tContentBase.call(this, 'react-phones');\n\n\t\tthis.totalReactionSpeed = 0;\n\t\tthis.numReactionSpeeds = 0;\n\t\tthis.numCorrectAnswers = 1;\n\t\tthis.averageReactionSpeed = 9999999;\n\t\tthis.visiblePosition = 0;\n\t\tthis.targetPosition = 0;\n\t\tthis.lastAnswerTime = new Date();\n\t\tthis.positions = [];\n\n\t\tthis.$game = $('#game');\n\t\tthis.$slidesContainer = $('.react-phones-slides-container');\n\t\tthis.$slide1 = $('.react-phones-slide-1');\n\t\tthis.$slide1text = $('.react-phones-slide-1 .react-phones-slide-text');\n\t\tthis.$slide2 = $('.react-phones-slide-2');\n\t\tthis.$slide2text = $('.react-phones-slide-2 .react-phones-slide-text');\n\n\t\t$('.touch .touchbutton').on('touchstart', $.proxy(this.onButtonTouchStart, this));\n\t\t$('.touch .touchbutton').on('touchend', $.proxy(this.onButtonTouchEnd, this));\n\n\t\t$('.no-touch .touchbutton').on('mousedown', $.proxy(this.onButtonTouchStart, this));\n\t\t$('.no-touch .touchbutton').on('mouseup', $.proxy(this.onButtonTouchEnd, this));\n\n\t\tthis.resetGame();\n\t}\n\n\tReactPhones.prototype = Object.create(ContentBase.prototype);\n\n\tReactPhones.prototype.onButtonTouchStart = function(e) {\n\t\t$(e.currentTarget).addClass('down');\n\t\tthis.selectAnswer($(e.currentTarget).text());\n\t};\n\n\tReactPhones.prototype.onButtonTouchEnd = function(e) {\n\t\t$(e.currentTarget).removeClass('down');\n\t};\n\n\tReactPhones.prototype.selectAnswer = function(answer) {\n\t\tvar now = new Date();\n\t\tvar time = now.getTime() - this.lastAnswerTime.getTime();\n\t\tthis.totalReactionSpeed += time;\n\t\tif(answer.toLowerCase() === this.positions[this.targetPosition].colorString.toLowerCase()) {\n\t\t\t//correct answer\n\t\t\tthis.numCorrectAnswers++;\n\t\t} else {\n\t\t\t//penalty time\n\t\t\tthis.totalReactionSpeed += 1000;\n\t\t}\n\t\tthis.numReactionSpeeds++;\n\t\tthis.lastAnswerTime = now;\n\t\tthis.targetPosition++;\n\t\tthis.fillPositionsWhenNeeded();\n\t\t//send to server\n\t\tthis.postSocketMessage({\n\t\t\ttarget: {\n\t\t\t\tclient: 'presentation',\n\t\t\t\tslide: 'react-phones'\n\t\t\t},\n\t\t\tcontent: {\n\t\t\t\taction: Constants.UPDATE_REACTION_SPEED,\n\t\t\t\treactionSpeed: this.totalReactionSpeed / this.numCorrectAnswers\n\t\t\t}\n\t\t});\n\t};\n\n\tReactPhones.prototype.receiveSocketMessage = function(message) {\n\t\tif(!message.content) {\n\t\t\treturn;\n\t\t}\n\t\tif(message.content.action === Constants.SET_SUBSTATE) {\n\t\t\tthis.setSubstate(message.content.substate);\n\t\t}\n\t};\n\n\tReactPhones.prototype.setSubstate = function(substate) {\n\t\tif(this.substate !== substate) {\n\t\t\tthis.substate = substate;\n\t\t\tthis.showCurrentState();\n\t\t}\n\t};\n\n\tReactPhones.prototype.showCurrentState = function() {\n\t\t$('.substate').removeClass('active');\n\t\tthis.$game.css({\n\t\t\t'z-index': -1,\n\t\t\t'opacity': 0.3\n\t\t});\n\t\tif(this.substate === Constants.REACT_PHONES_GAME) {\n\t\t\t$('.substate-game').addClass('active');\n\t\t\tthis.$game.css({\n\t\t\t\t'z-index': 10,\n\t\t\t\t'opacity': 1\n\t\t\t});\n\t\t} else if(this.substate === Constants.REACT_PHONES_FINISHED) {\n\t\t\t$('.substate-finished').addClass('active');\n\t\t} else {\n\t\t\t$('.substate-intro').addClass('active');\n\t\t}\n\t};\n\n\tReactPhones.prototype.onStateChanged = function() {\n\t\tif(this.state === Constants.STATE_ACTIVE) {\n\t\t\tthis.resetGame();\n\t\t}\n\t};\n\n\tReactPhones.prototype.resetGame = function() {\n\t\tthis.lastAnswerTime = new Date();\n\t\tthis.totalReactionSpeed = 0;\n\t\tthis.numReactionSpeeds = 0;\n\t\tthis.numCorrectAnswers = 1;\n\t\tthis.averageReactionSpeed = 9999999;\n\t\tthis.visiblePosition = 0;\n\t\tthis.targetPosition = 0;\n\t\tthis.positions = [];\n\t\tthis.fillPositionsWhenNeeded();\n\t};\n\n\tReactPhones.prototype.fillPositionsWhenNeeded = function() {\n\t\tvar numPositionsToAdd = this.numReactionSpeeds + 2 - this.positions.length;\n\t\tfor(var i = 0; i < numPositionsToAdd; i++) {\n\t\t\tvar position = {\n\t\t\t\tcolorString: (Math.random() > 0.5) ? 'red' : 'blue',\n\t\t\t\tbgcolor: (Math.random() > 0.5) ? '#c6363d' : '#0684AF'\n\t\t\t};\n\t\t\tif(position.colorString === 'red') {\n\t\t\t\tposition.color = '#c6363d';\n\t\t\t} else {\n\t\t\t\tposition.color = '#0684AF';\n\t\t\t}\n\t\t\tthis.positions.push(position);\n\t\t}\n\t};\n\n\tReactPhones.prototype.drawLoop = function() {\n\t\tthis.visiblePosition += (this.targetPosition - this.visiblePosition) * 0.1;\n\t\tif(this.visiblePosition % 1 > 0.995) {\n\t\t\tthis.visiblePosition = Math.round(this.visiblePosition);\n\t\t}\n\t\tthis.$slidesContainer.css('left', this.visiblePosition * -100 + '%');\n\n\t\tvar flooredVisiblePosition = Math.floor(this.visiblePosition);\n\t\tif(flooredVisiblePosition % 2 === 0) {\n\t\t\tthis.$slide1.css({\n\t\t\t\t'left' : flooredVisiblePosition * 100 + '%',\n\t\t\t\t'background-color' : this.positions[flooredVisiblePosition].bgcolor\n\t\t\t});\n\t\t\tthis.$slide2.css({\n\t\t\t\t'left' : flooredVisiblePosition * 100 + 100 + '%',\n\t\t\t\t'background-color' : this.positions[flooredVisiblePosition+1].bgcolor\n\t\t\t});\n\n\t\t\tthis.$slide1text.text(this.positions[flooredVisiblePosition].colorString);\n\t\t\tthis.$slide2text.text(this.positions[flooredVisiblePosition+1].colorString);\n\t\t} else {\n\t\t\tthis.$slide2.css({\n\t\t\t\t'left' : flooredVisiblePosition * 100 + '%',\n\t\t\t\t'background-color' : this.positions[flooredVisiblePosition].bgcolor\n\t\t\t});\n\t\t\tthis.$slide1.css({\n\t\t\t\t'left' : flooredVisiblePosition * 100 + 100 + '%',\n\t\t\t\t'background-color' : this.positions[flooredVisiblePosition+1].bgcolor\n\t\t\t});\n\n\t\t\tthis.$slide2text.text(this.positions[flooredVisiblePosition].colorString);\n\t\t\tthis.$slide1text.text(this.positions[flooredVisiblePosition+1].colorString);\n\t\t}\n\t};\n\n\treturn ReactPhones;\n\n})();","module.exports = (function(){\n\n\tvar Constants = require('Constants');\n\tvar ContentBase = require('shared/ContentBase');\n\t\n\tfunction ShakeYourPhones() {\n\t\tContentBase.call(this, 'shake-your-phones');\n\t\tthis.currentMotion = 0;\n\t\tthis.motion = 0;\n\t\tthis.maximumMotion = 0;\n\n\t\tthis.$background = $('.background');\n\t\tthis.$background.css('top', '100%');\n\t\tthis.$background.css('background-color', 'red');\n\n\t\tthis._motionUpdateHandler = this.motionUpdateHandler.bind(this);\n\t}\n\n\tShakeYourPhones.prototype = Object.create(ContentBase.prototype);\n\n\tShakeYourPhones.prototype.onStateChanged = function() {\n\t\tif(this.state === Constants.STATE_ACTIVE) {\n\t\t\tthis.maximumMotion = 0;\n\t\t\tif (window.DeviceMotionEvent) {\n\t\t\t\twindow.addEventListener('devicemotion', this._motionUpdateHandler, false);\n\t\t\t} else {\n\t\t\t\t$('.acceleration').text('Not supported on your device :-(');\n\t\t\t}\n\t\t} else {\n\t\t\twindow.removeEventListener('devicemotion', this._motionUpdateHandler);\n\t\t}\n\t};\n\n\tShakeYourPhones.prototype.receiveSocketMessage = function(message) {\n\t\tif(!message.content) {\n\t\t\treturn;\n\t\t}\n\t\tif(message.content.action === Constants.SET_SUBSTATE) {\n\t\t\tthis.setSubstate(message.content.substate);\n\t\t}\n\t};\n\n\tShakeYourPhones.prototype.setSubstate = function(substate) {\n\t\tif(this.substate !== substate) {\n\t\t\tthis.substate = substate;\n\t\t\tthis.showCurrentState();\n\t\t}\n\t};\n\n\tShakeYourPhones.prototype.motionUpdateHandler = function(event) {\n\t\tthis.currentMotion = event.interval * (Math.abs(event.acceleration.x) + Math.abs(event.acceleration.y) + Math.abs(event.acceleration.z));\n\t};\n\n\tShakeYourPhones.prototype.drawLoop = function() {\n\t\tthis.motion += this.currentMotion;\n\t\tthis.motion *= 0.97;\n\t\tthis.$background.css('top', 100 - this.motion + '%');\n\t\tthis.maximumMotion = Math.max(this.maximumMotion, this.motion);\n\t\tif(this.currentFrame % 10 === 0 && this.maximumMotion !== this.lastSentMaximumMotion) {\n\t\t\tthis.lastSentMaximumMotion = this.maximumMotion;\n\t\t\tthis.postSocketMessage({\n\t\t\t\ttarget: {\n\t\t\t\t\tclient: 'presentation',\n\t\t\t\t\tslide: 'shake-your-phones'\n\t\t\t\t},\n\t\t\t\tcontent: {\n\t\t\t\t\taction: Constants.UPDATE_MAXIMUM_MOTION,\n\t\t\t\t\tmaximumMotion: this.maximumMotion\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\tShakeYourPhones.prototype.showCurrentState = function() {\n\t\t$('.substate').removeClass('active');\n\t\tif(this.substate === Constants.SHAKE_YOUR_PHONES_GAME) {\n\t\t\t$('.substate-game').addClass('active');\n\t\t} else if(this.substate === Constants.SHAKE_YOUR_PHONES_FINISHED) {\n\t\t\t$('.substate-finished').addClass('active');\n\t\t} else {\n\t\t\t$('.substate-intro').addClass('active');\n\t\t}\n\t};\n\n\treturn ShakeYourPhones;\n\n})();"]}